<?php


namespace App\Libraries\Printers\Checks;


use App\Enums\BasketSource;
use App\Libraries\DTO\BasketGroupItem;
use App\Libraries\Printers\Exceptions\PrinterException;
use App\Libraries\System\FilialSettings;
use App\Models\Order\Order;
use Illuminate\Support\Collection;
use KKMClient\Helpers\CheckStringsBuilder;
use KKMClient\Models\AbstractCheck;

abstract class BaseCheck extends AbstractCheck
{
    protected Order $order;
    protected Collection $products;
    protected FilialSettings $filialSettings;

    public function __construct(Order $order, Collection $products)
    {
        $this->order = $order;
        $this->products = $products;
        $this->filialSettings = app()->make(FilialSettings::class);
    }


    /**
     * @param int | null $deviceNumber
     * @return $this
     * @throws PrinterException
     */
    public function setDeviceNumber($deviceNumber): self
    {
        if (empty($deviceNumber)) {
            throw new PrinterException("Номер устройства в kkmServer не может быть пустым");
        }

        $this->deviceNumber = $deviceNumber;
        return $this;
    }

    protected function getOrderNumber(): string
    {
        $orderNumber = $this->order->code;

        if ($this->order->kitchen_cell) {
            $orderNumber .= "-" . $this->order->kitchen_cell;
        }

        return $orderNumber;
    }


    protected function getQrCodeImageBase64(): string
    {
        return "Qk1QIwAAAAAAAD4AAAAoAAAAhAAAAIQAAAABAAQAAAAAABIjAAASCwAAEgsAAAIAAAACAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAABERAAAREQAAAAARERERAAAREREREREAAAAAEREAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREREREREREREREREREQAAEREAABERAAAAABEREREAABEREREREQAAAAAREQAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERERERERERERERERERAAAREQAAEREAAAAAEREREQAAERERERERAAAAABERAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAABERAAAREQAAAAARERERAAAREREREREAAAAAEREAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAREREREREAAAAAEREAABERAAAAABEREREAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAAABEREREREQAAAAAREQAAEREAAAAAEREREQAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAAAAAEREAAAAAERERERERAAAAABERAAAREQAAAAARERERAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAREREREREAAAAAEREAABERAAAAABEREREAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAAABERAAARERERAAAAABEREREAAAAAAAAAABEREREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAAAAAEREAABEREREAAAAAEREREQAAAAAAAAAAEREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAAAAREQAAEREREQAAAAARERERAAAAAAAAAAARERERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAAABERAAARERERAAAAABEREREAAAAAAAAAABEREREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAAAAAAAAREQAAAAAAABEREREREREREREAAAAAAAAAABEREREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAAAAAABERAAAAAAAAEREREREREREREQAAAAAAAAAAEREREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAAAAAAEREAAAAAAAARERERERERERERAAAAAAAAAAARERERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAAAAAAAAREQAAAAAAABEREREREREREREAAAAAAAAAABEREREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAAAAREQAAAAAREQAAEREREREREREREREREREAABERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAAABERAAAAABERAAAREREREREREREREREREQAAEREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAAAAAEREAAAAAEREAABERERERERERERERERERAAAREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAAAAREQAAAAAREQAAEREREREREREREREREREAABERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAAABERAAAAABEREREAABEREREAAAAAAAAREQAAAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAAAAAEREAAAAAEREAAAAAEREREQAAEREREQAAAAAAABERAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAREQAAAAARERERAAARERERAAAAAAAAEREAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAAABERAAAAABEREREAABEREREAAAAAAAAREQAAAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAAAAAAAARERERAAAAAAAAAAAREQAAEREAABERAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREREREREREREREREREQAAAAAAABEREREAAAAAAAAAABERAAAREQAAEREAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERERERERERERERERERAAAAAAAAEREREQAAAAAAAAAAEREAABERAAAREQAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAAAAAAAARERERAAAAAAAAAAAREQAAEREAABERAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREAABERAAAREREREREAABERAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAEREAABEREREREQAAEREAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAREQAAERERERERAAAREQAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREAABERAAAREREREREAABERAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAERERERERAAAAABERAAAREQAAEREREQAAAAAAABEREREREREREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAREREREREAAAAAEREAABERAAARERERAAAAAAAAERERERERERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEREREREQAAAAAREQAAEREAABEREREAAAAAAAAREREREREREREREREAABERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAERERERERAAAAABERAAAREQAAEREREQAAAAAAABEREREREREREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARERERAAARERERAAAAABERERERERERAAAAAAAAEREAABERAAAREQAAEREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAAABEREREAABEREREAAAAAEREREREREREAAAAAAAAREQAAEREAABERAAARERERAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREREQAAEREREQAAAAAREREREREREQAAAAAAABERAAAREQAAEREAABEREREAABERAAAAAAAAAAAAAAAAAAAAAAAAAAARERERAAARERERAAAAABERERERERERAAAAAAAAEREAABERAAAREQAAEREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAREQAAAAARERERAAAAAAAAEREREQAAAAAREQAAAAAREREREREREQAAEREREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREAABERAAAAABEREREAAAAAAAARERERAAAAABERAAAAABERERERERERAAARERERAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAEREAAAAAEREREQAAAAAAABEREREAAAAAEREAAAAAEREREREREREAABEREREAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAREQAAAAARERERAAAAAAAAEREREQAAAAAREQAAAAAREREREREREQAAEREREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAREQAAEREAABEREREAAAAAAAAAABEREREREQAAEREAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAABERAAAREQAAEREREQAAAAAAAAAAERERERERAAAREQAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAEREAABERAAARERERAAAAAAAAAAAREREREREAABERAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAREQAAEREAABEREREAAAAAAAAAABEREREREQAAEREAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREAAAAAERERERERAAAREQAAEREREQAAAAAREQAAEREAAAAAAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAEREREQAAAAAREREREREAABERAAARERERAAAAABERAAAREQAAAAAAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAARERERAAAAABEREREREQAAEREAABEREREAAAAAEREAABERAAAAAAAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREAAAAAERERERERAAAREQAAEREREQAAAAAREQAAEREAAAAAAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAEREAABERAAAAABEREREAABERAAAREREREREREQAAAAAREQAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAREQAAEREAAAAAEREREQAAEREAABERERERERERAAAAABERAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAABERAAAREQAAAAARERERAAAREQAAEREREREREREAAAAAEREAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAEREAABERAAAAABEREREAABERAAAREREREREREQAAAAAREQAAAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEREREAABEREREREQAAAAAREQAAERERERERERERERERERERERERAAARERERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREQAAERERERERAAAAABERAAAREREREREREREREREREREREREAABEREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARERERAAAREREREREAAAAAEREAABEREREREREREREREREREREREQAAEREREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEREREAABEREREREQAAAAAREQAAERERERERERERERERERERERERAAARERERAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAAABEREREAAAAAEREREREREREAABERAAARERERERERERERAAAAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAAAAAEREREQAAAAAREREREREREQAAEREAABEREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAAAAAAAARERERAAAAABERERERERERAAAREQAAEREREREREREREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAAABEREREAAAAAEREREREREREAABERAAARERERERERERERAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAEREAABERAAAREQAAAAAAABEREREREQAAAAAREREREREAAAAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAREQAAEREAABERAAAAAAAAERERERERAAAAABEREREREQAAAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAAAAAEREAABERAAAREQAAEREAAAAAAAAREREREREAAAAAERERERERAAAAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAEREAABERAAAREQAAAAAAABEREREREQAAAAAREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARERERERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEREREREREREREAABERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARERERERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAABERAAAREQAAEREAABERAAAREQAAEREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAREREREREREREREREREQAAEREAABERAAAREQAAEREAABERAAAREREREREREREREREREQAAAAAAAAAAAAAAAAAAAAAAABERERERERERERERERERAAAREQAAEREAABERAAAREQAAEREAABERERERERERERERERERAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAABERAAAREQAAEREAABERAAAREQAAEREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAREQAAAAAAAAAAEREAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAAABERAAAAAAAAAAAREQAAAAAAABERAAAAAAAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAAAAAEREAAAAAEREAAAAAAAAAABERAAAAAAAAEREAAAAAAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAREQAAAAAAAAAAEREAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAAABERAAARERERAAAREQAAAAAAABERAAAREREREREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAAAAAEREAABEREREAABERAAAAAAAAEREAABEREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAAAAREQAAEREREQAAEREAAAAAAAAREQAAERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAAABERAAARERERAAAREQAAAAAAABERAAAREREREREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAABEREREREQAAAAAREQAAEREREQAAEREAABEREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAERERERERAAAAABERAAARERERAAAREQAAERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAREREREREAAAAAEREAABEREREAABERAAAREREREREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAABEREREREQAAAAAREQAAEREREQAAEREAABEREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAEREAAAAAAAAAAAAAAAAAABERAAAREQAAERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAREREREREAABERAAAREQAAAAAAAAAAAAAAAAAAEREAABERAAAREREREREAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAABEREREREQAAEREAABERAAAAAAAAAAAAAAAAAAAREQAAEREAABEREREREQAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAERERERERAAAREQAAEREAAAAAAAAAAAAAAAAAABERAAAREQAAERERERERAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAREQAAAAAAAAAAEREAAAAAAAAAABERAAAAAAAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREAAAAAAAAAAAAAEREAABERAAAAAAAAAAAREQAAAAAAAAAAEREAAAAAAAAAAAAAEREAAAAAAAAAAAAAAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAEREAAAAAAAAAABERAAAAAAAAAAAREQAAAAAAAAAAAAAREQAAAAAAAAAAAAAAAAAAAAAAABERAAAAAAAAAAAAABERAAAREQAAAAAAAAAAEREAAAAAAAAAABERAAAAAAAAAAAAABERAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAAAAAAAAAABERAAAREQAAAAAAAAAAEREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAREREREREREREREREREQAAAAAAAAAAEREAABERAAAAAAAAAAAREREREREREREREREREQAAAAAAAAAAAAAAAAAAAAAAABERERERERERERERERERAAAAAAAAAAAREQAAEREAAAAAAAAAABERERERERERERERERERAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREAAAAAAAAAABERAAAREQAAAAAAAAAAEREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==";
    }

    protected function addHeader(CheckStringsBuilder $template): void
    {
        $template
            ->textCenter("СУШИФОКС", 1, 15)
            ->textCenter("Вкусно & Быстро", 3, 15)
            ->emptyLines(1)
            ->textCenter("8 (812) 338 - 1111", 3, 15)
            ->textCenter("www.sushifox.ru", 3, 15)
            ->emptyLines(1)
            ->textCenter("*****", 3, 15)
            ->emptyLines(3);
    }

    protected function addSiteLinkQRCode(CheckStringsBuilder $template): void
    {
        $template
            ->textCenter("Отсканируй", 3, 7)
            ->textCenter("чтобы оставить отзыв", 3, 7)

            ->qrCode("https://yandex.ru/search/?text=%D0%A1%D1%83%D1%88%D0%B8%D1%84%D0%BE%D0%BA%D1%81%20&lr=2&redircnt=1616367981.1")
            //->image($this->getQrCodeImageBase64())
            ->emptyLines(2)->textCenter("-");
    }

    protected function addProducts(CheckStringsBuilder $template)
    {
        $template
            ->emptyLines(1)
            ->lineSeparator('-')
            ->emptyLines(1);

        $this->products->each(fn(BasketGroupItem $item, $key) => $this->formatProductLine($item, $template));

        $template
            ->lineSeparator('-')
            ->emptyLines(1);
    }

    protected function addSourceLabel(CheckStringsBuilder $template): void
    {
        if ($this->order->basket->isSourceAggregator()) {
            $sourceName = BasketSource::getDescription($this->order->basket->basket_source);
            $template
                ->emptyLines(1)
                ->textCenter($sourceName, 2);
        }
    }



    /**
     * Форматирование и добавление
     * строки продукта в чек
     */
    abstract protected function formatProductLine(BasketGroupItem $item, CheckStringsBuilder $template): void;

}
